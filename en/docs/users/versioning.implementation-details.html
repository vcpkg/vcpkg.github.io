<head>
    <meta name="viewport" content="width=device-width">
    <link rel="icon" href="/assets/mark/mark.svg" />
        <link rel="icon" href="/assets/mark/favicon.png" />
        <link rel="mask-icon" href="/assets/mark/favicon-mask-icon.svg" />
    
        <!-- boostrap style sheet -->
        <link
          rel="stylesheet"
          href="https://ajax.aspnetcdn.com/ajax/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
          crossorigin="anonymous"
        />
        <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.1/build/styles/default.min.css"
          integrity="sha384-s4RLYRjGGbVqKOyMGGwfxUTMOO6D7r2eom7hWZQ6BjK2Df4ZyfzLXEkonSm0KLIQ"
          crossorigin="anonymous"
        />
    
        <!-- our style sheet and fonts -->
        <link href="/css/common.css" rel="stylesheet" />
        <link href="/css/getting-started.css" rel="stylesheet" />
    
        <!-- bootstrap scripts -->
        <script type="text/javascript"
          src="https://js.monitor.azure.com/scripts/c/ms.analytics-web-3.min.js">
        </script>
        <script src="https://wcpstatic.microsoft.com/mscc/lib/v2/wcp-consent.js"></script>
        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.6.0.min.js"></script>
        <script
          src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6"
          integrity="sha384-UBGmRyNtwBeGap4zdtKXLwUHdLJM9M/aSMLo8NaIzCxnLxYU6F9+V8veOXP3Fakh"
          crossorigin="anonymous"
        ></script>
        <script
          src="https://ajax.aspnetcdn.com/ajax/bootstrap/4.5.0/bootstrap.min.js"
          integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
          crossorigin="anonymous"
        ></script>
        <script
          src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.1/build/highlight.min.js"
          integrity="sha384-DmE/PJ3PvpXS92Z4Sn7vSRTqJd0T/2xkGtNgm2JaZFczBOZdCf3XbZOwnRHDgjAA"
          crossorigin="anonymous"
        ></script>
        <script
          src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.1/build/languages/cmake.min.js"
          integrity="sha384-x//ggWQQKDYM6gkxzOdTUJNX9tNhjYBuM1SkQ3kgwzlFH9cxNW2meFXccjs06ubh"
          crossorigin="anonymous"
        ></script>
        <script
          src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.7.1/build/languages/powershell.min.js"
          integrity="sha384-+05Cp42tk0QutdpySQ0HsmEskItQQcyh04nmNheHuy1epFAdvUC9kpiwJk9lx419"
          crossorigin="anonymous"
        ></script>
    
        <!-- our scripts -->
        <script src="/dist/common.js"></script>
        <script src="/dist/documentation.js"></script>
    <script>
        $(function () {
          $('#loadFooter').load('/en/footer.html');
        });
      </script>
    </head>
    <div id="loadNavBar"></div>
    <div id="banner"></div>
    <div class="page">
    <nav class="left-side">
      <div class="docs-mobile-heading hidden">Table of Contents</div>
      <div class="docs-mobile-exit hidden"><img class="docs-mobile-exit-icon" src="/assets/misc/exit-docs.svg"></div>
      <div class="search-bar">
        <input
                  class="search-box"
                  id="pkg-search"
                  type="search"
                  name="search"
                  placeholder="Search"
                  autocomplete="off"
                  oninput=""
                />
        <ul class="search hidden">
        </ul>
      </div>
      <div id="docsNavPane"></div>
      <script>
        $('#loadNavBar').load('/en/navbar.html', setScrollFocus);
        $('#docsNavPane').load('/en/docs/navpane.html', function () {
          $(function () {
            initDocumentation();
          });
        });
      </script>
</nav><main class="right-side" id="main">
<div class="docs-mobile-show"><img class="docs-mobile-show-table" src="/assets/misc/table-docs.svg">Table of Contents</div>
<h1 id="versioning-implementation-details">Versioning: Implementation details</h1>
<p><strong>The latest version of this documentation is available on <a href="https://github.com/Microsoft/vcpkg/tree/master/docs/users/versioning.implementation-details.md">GitHub</a>.</strong></p>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#minimum-versioning">Minimum versioning</a></li>
<li><a href="#constraint-resolution">Constraint resolution</a></li>
<li><a href="#acquiring-port-versions">Acquiring port versions</a></li>
</ul>
<h3 id="minimum-versioning">Minimum versioning</h3>
<p>vcpkg uses a minimal selection approach to versioning, inspired by the one <a href="https://research.swtch.com/vgo-mvs">used by Go</a>. But modified in some ways:</p>
<ul>
<li>Always starts from a fresh install, eliminates the need for upgrade/downgrade operations.</li>
<li>Allow unconstrained dependencies by introducing baselines.</li>
</ul>
<p>The minimal selection principle, however, stays the same. Given a set of constraints, vcpkg will use the "oldest" possible versions of packages that can satisfy all the constraints.</p>
<p>Using a minimum version approach has the following advantages:</p>
<ul>
<li>Is predictable and easy to understand.</li>
<li>User controls when upgrades happen, as in, no upgrades are performed automatically when a new version is released.</li>
<li>Avoids using a SAT solver.</li>
</ul>
<p>To give an example, consider the following package graph:</p>
<pre><code>    (A 1.0) -&gt; (B 1.0)

    (A 1.1) -&gt; (B 1.0) 
            -&gt; (C 3.0) 

    (A 1.2) -&gt; (B 2.0)
            -&gt; (C 3.0)

    (C 2.0)</code></pre>
<p>And the following manifest:</p>
<pre><code>{
    "name": "example",
    "version": "1.0.0",
    "dependencies": [ 
        { "name": "A", "version&gt;=": "1.1" },
        { "name": "C", "version&gt;=": "2.0" }
    ], 
    "builtin-baseline": "&lt;some git commit with A's baseline at 1.0&gt;"
}</code></pre>
<p>After accounting for transitive dependencies we have the following set of constraints:</p>
<ul>
<li>A &gt;= 1.1<ul>
<li>B &gt;= 1.0</li>
<li>C &gt;= 3.0</li></ul></li>
<li>C &gt;= 2.0</li>
</ul>
<p>Since vcpkg has to satisfy all the constraints, the set of installed packages becomes:</p>
<ul>
<li><code>A 1.1</code>, even when <code>A 1.2</code> exists, there are no constraints higher than <code>1.1</code> so vcpkg selects the minimum version possible.</li>
<li><code>B 1.0</code>, transitively required by <code>A 1.1</code>.</li>
<li><code>C 3.0</code>, upgraded by the transitive constraint added by <code>B 1.0</code> in order to satisfy version constraints.</li>
</ul>
<h2 id="constraint-resolution">Constraint resolution</h2>
<p>Given a manifest with a set of versioned dependencies, vcpkg will attempt to calculate a package installation plan that satisfies all the constraints. </p>
<p>Version constraints come in the following flavors:</p>
<ul>
<li><strong>Declared constraints</strong>: Constraints declared explicitly in the top-level manifest using <code>version&gt;=</code>.</li>
<li><strong>Baseline constraints</strong>: Constraints added implicitly by the <code>builtin-baseline</code>.</li>
<li><strong>Transitive constraints</strong>: Constraints added indirectly by dependencies of your dependencies.</li>
<li><strong>Overridden constraints</strong>: Constraints overridden in the top-level manifest using <code>overrides</code> declarations.</li>
</ul>
<p>To compute an installation plan, vcpkg follows roughly these steps:</p>
<ul>
<li>Add all top-level constraints to the plan.</li>
<li>Recursively add transitive constraints to the plan.<ul>
<li>Each time a new package is added to the plan, also add its baseline constraint to the plan.</li>
<li>Each time a constraint is added:</li>
<li>If an override exists for the package<ul>
<li>Select the version in the override.</li></ul></li>
<li>Otherwise:<ul>
<li>If there is no previous version selected. <ul>
<li>Select the minimal version that satisfies the constraint.</li></ul></li>
<li>If there is a previous version selected:<ul>
<li>If the versioning scheme of the new constraint does not match that of the previously selected version:<ul>
<li>Add a version conflict.</li></ul></li>
<li>If the constraint's version is not comparable to the previously selected version. For example, comparing "version-string: apple" to "version-string: orange":<ul>
<li>Add a version conflict.</li></ul></li>
<li>If the constraints version is higher than the previously selected version:<ul>
<li>Select the highest version.</li></ul></li>
<li>Otherwise: <ul>
<li>Keep the previous selection.</li></ul></li></ul></li></ul></li></ul></li>
<li>Review the plan:<ul>
<li>If there are no conflicts</li>
<li>Install the selected packages</li>
<li>Otherwise:</li>
<li>Report the conflicts to the user</li></ul></li>
</ul>
<h2 id="acquiring-port-versions">Acquiring port versions</h2>
<p>Although the concept of package versions has always been present in vcpkg, the concept of version constraints has been not.</p>
<p>With the introduction of versioning constraints, it is now possible that a package depends on a port version that does not match the one available locally. This raises a problem as vcpkg needs to know how to acquire the port files for the requested version.</p>
<p>To solve this problem, a new set of metadata files was introduced. These files are located in the <code>versions/</code> directory at the root level of the vcpkg repository.</p>
<p>The <code>versions/</code> directory, will contain JSON files for each one of the ports available in the registry. Each file will list all the versions available for a package and contain a Git tree-ish object that vcpkg can check out to obtain that version's portfiles.</p>
<p>Example: <code>zlib.json</code></p>
<pre><code>{
  "versions": [
    {
      "git-tree": "2dfc991c739ab9f2605c2ad91a58a7982eb15687",
      "version-string": "1.2.11",
      "port-version": 9
    },
    ...
    {
      "git-tree": "a516e5ee220c8250f21821077d0e3dd517f02631",
      "version-string": "1.2.10",
      "port-version": 0
    },
    {
      "git-tree": "3309ec82cd96d752ff890c441cb20ef49b52bf94",
      "version-string": "1.2.8",
      "port-version": 0
    }
  ]
}</code></pre>
<p>For each port, its corresponding versions file should be located in <code>versions/{first letter of port name}-/{port name}.json</code>. For example, zlib's version file will be located in <code>versions/z-/zlib.json</code>. Aside from port version files, the current baseline file is located in <code>versions/baseline.json</code>.</p>
</main></div><div id="loadFooter"></div></html>
